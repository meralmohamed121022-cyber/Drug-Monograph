<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Complete Pharmacy Quiz Export System</title>
<style>
@import url('https://fonts.googleapis.com/css?family=Roboto&display=swap');
body {
  font-family: 'Roboto', sans-serif;
  background: #ffffff;
  color: #001f3f;
  max-width: 1100px;
  margin: 40px auto;
  padding: 30px;
  border-radius: 10px;
}
h1 {
  text-align: center;
  font-weight: 900;
  color: #ff851b;
  margin-bottom: 40px;
  text-transform: uppercase;
  letter-spacing: 4px;
  text-shadow: 0 0 12px #ff851b;
}
.quiz-container {
  background: #f6f8fc;
  border-radius: 20px;
  padding: 35px 40px;
  box-shadow: 0 0 40px rgba(255, 133, 27, 0.2);
}
.question-number {
  font-weight: 700;
  font-size: 20px;
  color: #ff851b;
  margin-bottom: 20px;
  text-shadow: 0 0 6px #ff851b;
}
.question-text {
  font-size: 28px;
  font-weight: 900;
  color: #001f3f;
  margin-bottom: 35px;
  line-height: 1.4;
  background: linear-gradient(45deg, rgba(255, 133, 27, 0.15) 25%, rgba(1, 31, 63, 0.1) 50%, rgba(255, 133, 27, 0.15) 75%);
  border-radius: 18px;
  padding: 25px 30px;
  text-shadow: none;
  text-align: center;
}
.options {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 26px 20px;
}
.options label {
  display: flex;
  align-items: center;
  background: #ffa64d;
  border-radius: 15px;
  padding: 18px 25px;
  font-weight: 700;
  font-size: 18px;
  color: #001f3f;
  cursor: pointer;
  transition: background-color 0.3s ease, transform 0.3s ease;
  box-shadow: 0 6px 15px rgba(0,0,0,0.12);
}
.options label:hover {
  background: #ff7f00;
  box-shadow: 0 8px 22px rgba(0,0,0,0.25);
  transform: scale(1.08);
}
.options label.correct {
  background: #28a745;
  color: #fff;
  box-shadow: 0 6px 20px rgba(40, 167, 69, 0.6);
  border: 2px solid #1e7e34;
}
.options label.incorrect {
  background: #dc3545;
  color: #fff;
  box-shadow: 0 6px 20px rgba(220, 53, 69, 0.6);
  border: 2px solid #a71d2a;
}
.options input[type=radio] {
  margin-right: 15px;
  transform: scale(1.4);
}
button {
  width: 100%;
  background: linear-gradient(90deg, #ff851b 0%, #cc7000 100%);
  color: #001f3f;
  padding: 20px 0;
  font-size: 24px;
  border: none;
  border-radius: 30px;
  font-weight: 900;
  margin-top: 45px;
  cursor: pointer;
  box-shadow: 0 10px 30px rgba(255, 133, 27, 0.9);
  transition: background 0.3s ease;
}
button:disabled {
  background: #ffbf80;
  cursor: not-allowed;
}
button:hover:not(:disabled) {
  background: linear-gradient(90deg, #cc7000 0%, #ff9a1a 100%);
}
.result-container {
  display: none;
  background: #f7f9fa;
  padding: 50px;
  border-radius: 30px;
  box-shadow: 0 10px 40px rgba(255, 133, 27, 0.25);
  margin-top: 50px;
  color: #001f3f;
}
.score-summary {
  font-size: 36px;
  font-weight: 900;
  text-align: center;
  margin-bottom: 50px;
  color: #ff851b;
  text-shadow: 0 0 18px #ff851b;
}
#chartContainer {
  max-width: 460px;
  margin: 0 auto 50px auto;
  border-radius: 22px;
  background: #001f3f;
  padding: 20px;
  box-shadow: 0 0 30px #ff9a1acc inset;
}
#resultChart {
  display: block;
  width: 100% !important;
  height: auto !important;
}
.result-row {
  display: flex;
  gap: 30px;
  margin-bottom: 30px;
}
.result-box {
  flex: 1;
}
.result-box .options input[type=radio] {
  display: none;
}
.result-box .options label {
  cursor: default;
}
.export-btn {
  background: #17a2b8;
  color: white;
  border: none;
  padding: 18px 0;
  font-size: 22px;
  border-radius: 30px;
  width: 100%;
  cursor: pointer;
  font-weight: 900;
  box-shadow: 0 6px 30px rgba(23,162,184,0.8);
  transition: background 0.3s ease;
  margin-bottom: 20px;
}
.export-btn:hover {
  background: #138496;
}
.restart-btn {
  background: #004080;
  color: white;
  border: none;
  padding: 18px 0;
  font-size: 22px;
  border-radius: 30px;
  width: 100%;
  cursor: pointer;
  font-weight: 900;
  box-shadow: 0 6px 30px rgba(0,64,128,0.8);
  transition: background 0.3s ease;
  margin-top: 20px;
}
.restart-btn:hover {
  background: #002850;
}

/* Export styles - ŸÑŸÑÿπÿ±ÿ∂ ŸÅŸä PDF ŸÅŸÇÿ∑ */
.export-full-results {
  display: none;
  background: #ffffff;
  padding: 0;
  margin: 0;
}
.export-full-results.active {
  display: block;
}
.export-full-results h1 {
  text-align: center;
  font-weight: 900;
  color: #ff851b;
  margin-bottom: 30px;
  text-transform: uppercase;
  letter-spacing: 4px;
  text-shadow: 0 0 12px #ff851b;
  font-size: 24px;
}
.export-full-results .full-question {
  background: #f6f8fc;
  border-radius: 20px;
  padding: 25px 30px;
  box-shadow: 0 0 40px rgba(255, 133, 27, 0.2);
  margin-bottom: 25px;
  page-break-inside: avoid;
}
.export-full-results .full-question-number {
  font-weight: 700;
  font-size: 18px;
  color: #ff851b;
  margin-bottom: 15px;
  text-shadow: 0 0 6px #ff851b;
}
.export-full-results .full-question-text {
  font-size: 20px;
  font-weight: 900;
  color: #001f3f;
  margin-bottom: 20px;
  line-height: 1.4;
  background: linear-gradient(45deg, rgba(255, 133, 27, 0.15) 25%, rgba(1, 31, 63, 0.1) 50%, rgba(255, 133, 27, 0.15) 75%);
  border-radius: 15px;
  padding: 18px 22px;
  text-align: center;
}
.export-full-results .full-options {
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px;
}
.export-full-results .full-option {
  display: flex;
  align-items: center;
  background: #ffa64d;
  border-radius: 12px;
  padding: 14px 20px;
  font-weight: 700;
  font-size: 16px;
  color: #001f3f;
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
}
.export-full-results .full-option.correct {
  background: #28a745;
  color: #fff;
  box-shadow: 0 4px 15px rgba(40, 167, 69, 0.6);
  border: 2px solid #1e7e34;
}
.export-full-results .full-option.incorrect {
  background: #dc3545;
  color: #fff;
  box-shadow: 0 4px 15px rgba(220, 53, 69, 0.6);
  border: 2px solid #a71d2a;
}
</style>
</head>
<body>
<h1>üè• Pharmacy Quiz System</h1>
<div class="quiz-container">
  <div id="questionNumber" class="question-number"></div>
  <div id="questionText" class="question-text"></div>
  <div id="optionsContainer" class="options"></div>
  <button id="nextBtn" disabled>Next Question ‚û°Ô∏è</button>
</div>
<div id="resultContainer" class="result-container">
  <div id="chartContainer">
    <canvas id="resultChart"></canvas>
  </div>
  <div class="score-summary" id="scoreSummary"></div>
  <button class="export-btn" id="exportBtn">üìÑ Export Complete Results as PDF</button>
  <div id="resultsWrapper"></div>
  <button class="restart-btn" id="restartBtn">Retake Quiz üîÑ</button>
</div>

<!-- Container ŸÑŸÑŸÄ Export ÿßŸÑŸÉÿßŸÖŸÑ -->
<div id="exportFullResults" class="export-full-results">
  <div style="padding: 30px;">
    <h1>üè• Complete Pharmacy Quiz Results</h1>
    <div id="exportContent"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
const questions = [
  {"question":"A 68-year-old patient with heart failure is prescribed Furosemide 40mg BID and mentions recent Gentamicin injection for UTI. What is your MOST important counseling action?","options":["Recommend taking furosemide with food to reduce GI upset","Immediately counsel about reporting any hearing changes or tinnitus","Suggest increasing fluid intake to prevent dehydration","Advise monitoring blood pressure twice daily","Recommend potassium supplementation"],"correct":1},
  {"question":"For optimal therapeutic effect of Nystatin oral suspension in treating oral thrush, what is the CRITICAL patient instruction?","options":["Take immediately after meals to improve absorption","Dilute with equal amount of water before use","Swish in mouth for several minutes before swallowing","Store at room temperature after opening","Avoid dairy products for 2 hours after administration"],"correct":2},
  {"question":"A patient with M√©ni√®re's disease on Betahistine 16mg BID reports the medication isn't working anymore. Which concurrent medication is MOST likely causing decreased efficacy?","options":["Warfarin 5mg daily","Cetirizine 10mg daily for allergies","Metformin 500mg BID","Atorvastatin 20mg at bedtime","Omeprazole 20mg daily"],"correct":1},
  {"question":"When dispensing Amoxicillin-Clavulanate 875/125mg BID, pediatric dosing calculations should be based on which component?","options":["Amoxicillin component only (15-90 mg/kg/day)","Clavulanic acid component only","Combined total dose of both components","Patient's body surface area","Severity and type of infection"],"correct":0},
  {"question":"A student with recurrent mouth ulcers during exam periods asks for prevention advice. Which recommendation has the STRONGEST evidence base?","options":["Daily high-dose vitamin C supplementation","Switch to sodium lauryl sulfate-free toothpaste","Use antiseptic mouthwash twice daily","Completely avoid all acidic foods","Take probiotics with every meal"],"correct":1},
  {"question":"A frequent business traveler asks about preventing airplane ear pain. When should you recommend pseudoephedrine administration?","options":["30-60 minutes before takeoff","Immediately during takeoff symptoms","Only upon landing","The night before travel","Continuously throughout the flight"],"correct":0},
  {"question":"Which medication class is MOST likely causing severe dry mouth in your elderly patient?","options":["ACE inhibitors (blood pressure)","Anticholinergic antihistamines (Diphenhydramine)","Calcium channel blockers","NSAIDs for arthritis","Vitamin D supplements"],"correct":1},
  {"question":"A patient reports penicillin allergy but describes only stomach upset from 15 years ago. Your BEST professional response?","options":["Avoid all beta-lactam antibiotics permanently","True allergic reactions involve skin rashes or breathing difficulties","Use only macrolide antibiotics as alternatives","Recommend allergy testing before any antibiotic","Reduce all penicillin doses by 50%"],"correct":1}
];

let currentIndex = 0;
let score = 0;
let userAnswers = [];
let shuffledQuestions = [];

const questionNumberEl = document.getElementById('questionNumber');
const questionTextEl = document.getElementById('questionText');
const optionsContainer = document.getElementById('optionsContainer');
const nextBtn = document.getElementById('nextBtn');
const quizContainer = document.querySelector('.quiz-container');
const resultContainer = document.getElementById('resultContainer');
const scoreSummaryEl = document.getElementById('scoreSummary');
const resultsWrapper = document.getElementById('resultsWrapper');
const restartBtn = document.getElementById('restartBtn');
const exportBtn = document.getElementById('exportBtn');

function shuffle(array) {
  const arr = array.slice();
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function loadQuestion() {
  nextBtn.disabled = true;
  nextBtn.textContent = currentIndex === shuffledQuestions.length - 1 ? 'View Results üìä' : 'Next Question ‚û°Ô∏è';

  const currentQ = shuffledQuestions[currentIndex];
  questionNumberEl.textContent = `Question ${currentIndex + 1} of ${shuffledQuestions.length}`;
  questionTextEl.textContent = currentQ.question;
  optionsContainer.innerHTML = '';

  currentQ.options.forEach((opt, idx) => {
    const label = document.createElement('label');
    label.innerHTML = `<input type="radio" name="option" value="${idx}"> ${opt}`;
    optionsContainer.appendChild(label);
  });

  optionsContainer.addEventListener('change', () => {
    nextBtn.disabled = false;
  }, { once: true });
}

function showResults() {
  quizContainer.style.display = 'none';
  resultContainer.style.display = 'block';

  const total = shuffledQuestions.length;
  const percentage = ((score / total) * 100).toFixed(1);

  let message;
  if (percentage >= 85) {
    message = `üéâ Excellent work! You scored ${score} out of ${total} (${percentage}%)`;
  } else if (percentage >= 60) {
    message = `üëç Good job! You scored ${score} out of ${total} (${percentage}%)`;
  } else if (percentage >= 40) {
    message = `‚ö†Ô∏è Fair effort! You scored ${score} out of ${total} (${percentage}%) - Room for improvement`;
  } else {
    message = `üö® Keep practicing! You scored ${score} out of ${total} (${percentage}%) - More study needed`;
  }

  scoreSummaryEl.textContent = message;

  if(window.chart) window.chart.destroy();

  const ctx = document.getElementById('resultChart').getContext('2d');
  window.chart = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['Correct ‚úÖ', 'Incorrect ‚ùå'],
      datasets: [{
        data: [score, total - score],
        backgroundColor: ['#ff851b', '#001f3f'],
        borderWidth: 3,
        borderColor: '#fff'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'bottom', labels: {color: '#001f3f', font: {weight:'bold', size:16}} },
        tooltip: { enabled: true }
      }
    }
  });

  // Generate results display
  resultsWrapper.innerHTML = '';
  for(let i = 0; i < shuffledQuestions.length; i += 2) {
    const row = document.createElement('div');
    row.className = 'result-row';

    for(let j = i; j < i + 2 && j < shuffledQuestions.length; j++) {
      const question = shuffledQuestions[j];
      const userAnswer = userAnswers[j];
      const correctIndex = question.correct;

      const box = document.createElement('div');
      box.className = 'result-box quiz-container';

      box.innerHTML = 
        `<div class="question-number">Question ${j + 1} of ${shuffledQuestions.length}</div>` +
        `<div class="question-text">${question.question}</div>` +
        `<div class="options">` +
        question.options.map((opt, idx) => {
          let classes = '';
          if(idx === correctIndex) classes = 'correct';
          else if(idx === userAnswer && idx !== correctIndex) classes = 'incorrect';
          return `<label class="${classes}">${opt}</label>`;
        }).join('') +
        `</div>`;

      row.appendChild(box);
    }
    resultsWrapper.appendChild(row);
  }

  // Prepare full export content
  prepareFullExportContent();
}

function prepareFullExportContent() {
  const exportContent = document.getElementById('exportContent');
  exportContent.innerHTML = '';

  // Add score summary to export
  const scoreDiv = document.createElement('div');
  scoreDiv.style.cssText = 'font-size: 24px; font-weight: 900; text-align: center; margin-bottom: 40px; color: #ff851b; text-shadow: 0 0 18px #ff851b;';
  const total = shuffledQuestions.length;
  const percentage = ((score / total) * 100).toFixed(1);
  let message = `Final Score: ${score}/${total} (${percentage}%)`;
  scoreDiv.textContent = message;
  exportContent.appendChild(scoreDiv);

  // Add all questions to export
  shuffledQuestions.forEach((question, j) => {
    const userAnswer = userAnswers[j];
    const correctIndex = question.correct;

    const questionDiv = document.createElement('div');
    questionDiv.className = 'full-question';

    questionDiv.innerHTML = 
      `<div class="full-question-number">Question ${j + 1} of ${shuffledQuestions.length}</div>` +
      `<div class="full-question-text">${question.question}</div>` +
      `<div class="full-options">` +
      question.options.map((opt, idx) => {
        let classes = '';
        if(idx === correctIndex) classes = 'correct';
        else if(idx === userAnswer && idx !== correctIndex) classes = 'incorrect';
        return `<div class="full-option ${classes}">${opt}</div>`;
      }).join('') +
      `</div>`;

    exportContent.appendChild(questionDiv);
  });
}

// Complete PDF Export with all styled content
exportBtn.addEventListener('click', () => {
  const exportElement = document.getElementById('exportFullResults');
  
  // Show export element
  exportElement.classList.add('active');
  
  const opt = {
    margin: 15,
    filename: 'complete_pharmacy_quiz_results.pdf',
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { 
      scale: 2, 
      useCORS: true,
      allowTaint: true,
      scrollX: 0,
      scrollY: 0
    },
    jsPDF: { 
      unit: 'mm', 
      format: 'a4', 
      orientation: 'portrait'
    },
    pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
  };

  html2pdf().set(opt).from(exportElement).save().then(() => {
    // Hide export element after completion
    exportElement.classList.remove('active');
  });
});

nextBtn.addEventListener('click', () => {
  const selectedOption = document.querySelector('input[name="option"]:checked');
  if (!selectedOption) return;
  userAnswers[currentIndex] = parseInt(selectedOption.value);

  if (userAnswers[currentIndex] === shuffledQuestions[currentIndex].correct) {
    score++;
  }

  currentIndex++;
  if (currentIndex < shuffledQuestions.length) {
    loadQuestion();
  } else {
    showResults();
  }
});

restartBtn.addEventListener('click', () => {
  currentIndex = 0;
  score = 0;
  userAnswers = [];
  resultContainer.style.display = 'none';
  quizContainer.style.display = 'block';
  shuffledQuestions = shuffle(questions);
  loadQuestion();
});

shuffledQuestions = shuffle(questions);
loadQuestion();
</script>
</body>
</html>